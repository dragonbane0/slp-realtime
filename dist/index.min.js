"use strict";
function e(e) {
  return e && "object" == typeof e && "default" in e ? e.default : e;
}
Object.defineProperty(exports, "__esModule", { value: !0 });
var t,
  r,
  n = require("rxjs"),
  o = require("@slippi/slippi-js"),
  s = require("lodash"),
  i = require("child_process"),
  a = e(require("os")),
  c = require("stream"),
  u = e(require("fs")),
  p = e(require("path")),
  l = e(require("chokidar")),
  h = e(require("tailstream"));
!(function (e) {
  (e.START = "combo-start"),
    (e.EXTEND = "combo-extend"),
    (e.END = "combo-occurred"),
    (e.CONVERSION = "conversion-occurred");
})(exports.ComboEvent || (exports.ComboEvent = {})),
  ((t = exports.GameEvent || (exports.GameEvent = {})).GAME_START = "game-start"),
  (t.GAME_END = "game-end"),
  ((exports.InputEvent || (exports.InputEvent = {})).BUTTON_COMBO = "button-combo"),
  ((r = exports.StockEvent || (exports.StockEvent = {})).PLAYER_SPAWN = "player-spawn"),
  (r.PLAYER_DIED = "player-died");
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var d = function (e, t) {
  return (d =
    Object.setPrototypeOf ||
    ({ __proto__: [] } instanceof Array &&
      function (e, t) {
        e.__proto__ = t;
      }) ||
    function (e, t) {
      for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]);
    })(e, t);
};
function f(e, t) {
  function r() {
    this.constructor = e;
  }
  d(e, t), (e.prototype = null === t ? Object.create(t) : ((r.prototype = t.prototype), new r()));
}
function m(e) {
  return "function" == typeof e;
}
var b = !1,
  y = {
    Promise: void 0,
    set useDeprecatedSynchronousErrorHandling(e) {
      e && new Error().stack;
      b = e;
    },
    get useDeprecatedSynchronousErrorHandling() {
      return b;
    },
  };
function S(e) {
  setTimeout(function () {
    throw e;
  }, 0);
}
var v = {
    closed: !0,
    next: function (e) {},
    error: function (e) {
      if (y.useDeprecatedSynchronousErrorHandling) throw e;
      S(e);
    },
    complete: function () {},
  },
  _ = (function () {
    return (
      Array.isArray ||
      function (e) {
        return e && "number" == typeof e.length;
      }
    );
  })();
function x(e) {
  return null !== e && "object" == typeof e;
}
var E = (function () {
    function e(e) {
      return (
        Error.call(this),
        (this.message = e
          ? e.length +
            " errors occurred during unsubscription:\n" +
            e
              .map(function (e, t) {
                return t + 1 + ") " + e.toString();
              })
              .join("\n  ")
          : ""),
        (this.name = "UnsubscriptionError"),
        (this.errors = e),
        this
      );
    }
    return (e.prototype = Object.create(Error.prototype)), e;
  })(),
  I = (function () {
    function e(e) {
      (this.closed = !1), (this._parentOrParents = null), (this._subscriptions = null), e && (this._unsubscribe = e);
    }
    return (
      (e.prototype.unsubscribe = function () {
        var t;
        if (!this.closed) {
          var r = this._parentOrParents,
            n = this._unsubscribe,
            o = this._subscriptions;
          if (((this.closed = !0), (this._parentOrParents = null), (this._subscriptions = null), r instanceof e))
            r.remove(this);
          else if (null !== r)
            for (var s = 0; s < r.length; ++s) {
              r[s].remove(this);
            }
          if (m(n))
            try {
              n.call(this);
            } catch (e) {
              t = e instanceof E ? A(e.errors) : [e];
            }
          if (_(o)) {
            s = -1;
            for (var i = o.length; ++s < i; ) {
              var a = o[s];
              if (x(a))
                try {
                  a.unsubscribe();
                } catch (e) {
                  (t = t || []), e instanceof E ? (t = t.concat(A(e.errors))) : t.push(e);
                }
            }
          }
          if (t) throw new E(t);
        }
      }),
      (e.prototype.add = function (t) {
        var r = t;
        if (!t) return e.EMPTY;
        switch (typeof t) {
          case "function":
            r = new e(t);
          case "object":
            if (r === this || r.closed || "function" != typeof r.unsubscribe) return r;
            if (this.closed) return r.unsubscribe(), r;
            if (!(r instanceof e)) {
              var n = r;
              (r = new e())._subscriptions = [n];
            }
            break;
          default:
            throw new Error("unrecognized teardown " + t + " added to Subscription.");
        }
        var o = r._parentOrParents;
        if (null === o) r._parentOrParents = this;
        else if (o instanceof e) {
          if (o === this) return r;
          r._parentOrParents = [o, this];
        } else {
          if (-1 !== o.indexOf(this)) return r;
          o.push(this);
        }
        var s = this._subscriptions;
        return null === s ? (this._subscriptions = [r]) : s.push(r), r;
      }),
      (e.prototype.remove = function (e) {
        var t = this._subscriptions;
        if (t) {
          var r = t.indexOf(e);
          -1 !== r && t.splice(r, 1);
        }
      }),
      (e.EMPTY = (function (e) {
        return (e.closed = !0), e;
      })(new e())),
      e
    );
  })();
function A(e) {
  return e.reduce(function (e, t) {
    return e.concat(t instanceof E ? t.errors : t);
  }, []);
}
var g = (function () {
    return "function" == typeof Symbol ? Symbol("rxSubscriber") : "@@rxSubscriber_" + Math.random();
  })(),
  C = (function (e) {
    function t(r, n, o) {
      var s = e.call(this) || this;
      switch (
        ((s.syncErrorValue = null),
        (s.syncErrorThrown = !1),
        (s.syncErrorThrowable = !1),
        (s.isStopped = !1),
        arguments.length)
      ) {
        case 0:
          s.destination = v;
          break;
        case 1:
          if (!r) {
            s.destination = v;
            break;
          }
          if ("object" == typeof r) {
            r instanceof t
              ? ((s.syncErrorThrowable = r.syncErrorThrowable), (s.destination = r), r.add(s))
              : ((s.syncErrorThrowable = !0), (s.destination = new D(s, r)));
            break;
          }
        default:
          (s.syncErrorThrowable = !0), (s.destination = new D(s, r, n, o));
      }
      return s;
    }
    return (
      f(t, e),
      (t.prototype[g] = function () {
        return this;
      }),
      (t.create = function (e, r, n) {
        var o = new t(e, r, n);
        return (o.syncErrorThrowable = !1), o;
      }),
      (t.prototype.next = function (e) {
        this.isStopped || this._next(e);
      }),
      (t.prototype.error = function (e) {
        this.isStopped || ((this.isStopped = !0), this._error(e));
      }),
      (t.prototype.complete = function () {
        this.isStopped || ((this.isStopped = !0), this._complete());
      }),
      (t.prototype.unsubscribe = function () {
        this.closed || ((this.isStopped = !0), e.prototype.unsubscribe.call(this));
      }),
      (t.prototype._next = function (e) {
        this.destination.next(e);
      }),
      (t.prototype._error = function (e) {
        this.destination.error(e), this.unsubscribe();
      }),
      (t.prototype._complete = function () {
        this.destination.complete(), this.unsubscribe();
      }),
      (t.prototype._unsubscribeAndRecycle = function () {
        var e = this._parentOrParents;
        return (
          (this._parentOrParents = null),
          this.unsubscribe(),
          (this.closed = !1),
          (this.isStopped = !1),
          (this._parentOrParents = e),
          this
        );
      }),
      t
    );
  })(I),
  D = (function (e) {
    function t(t, r, n, o) {
      var s,
        i = e.call(this) || this;
      i._parentSubscriber = t;
      var a = i;
      return (
        m(r)
          ? (s = r)
          : r &&
            ((s = r.next),
            (n = r.error),
            (o = r.complete),
            r !== v &&
              (m((a = Object.create(r)).unsubscribe) && i.add(a.unsubscribe.bind(a)),
              (a.unsubscribe = i.unsubscribe.bind(i)))),
        (i._context = a),
        (i._next = s),
        (i._error = n),
        (i._complete = o),
        i
      );
    }
    return (
      f(t, e),
      (t.prototype.next = function (e) {
        if (!this.isStopped && this._next) {
          var t = this._parentSubscriber;
          y.useDeprecatedSynchronousErrorHandling && t.syncErrorThrowable
            ? this.__tryOrSetError(t, this._next, e) && this.unsubscribe()
            : this.__tryOrUnsub(this._next, e);
        }
      }),
      (t.prototype.error = function (e) {
        if (!this.isStopped) {
          var t = this._parentSubscriber,
            r = y.useDeprecatedSynchronousErrorHandling;
          if (this._error)
            r && t.syncErrorThrowable
              ? (this.__tryOrSetError(t, this._error, e), this.unsubscribe())
              : (this.__tryOrUnsub(this._error, e), this.unsubscribe());
          else if (t.syncErrorThrowable)
            r ? ((t.syncErrorValue = e), (t.syncErrorThrown = !0)) : S(e), this.unsubscribe();
          else {
            if ((this.unsubscribe(), r)) throw e;
            S(e);
          }
        }
      }),
      (t.prototype.complete = function () {
        var e = this;
        if (!this.isStopped) {
          var t = this._parentSubscriber;
          if (this._complete) {
            var r = function () {
              return e._complete.call(e._context);
            };
            y.useDeprecatedSynchronousErrorHandling && t.syncErrorThrowable
              ? (this.__tryOrSetError(t, r), this.unsubscribe())
              : (this.__tryOrUnsub(r), this.unsubscribe());
          } else this.unsubscribe();
        }
      }),
      (t.prototype.__tryOrUnsub = function (e, t) {
        try {
          e.call(this._context, t);
        } catch (e) {
          if ((this.unsubscribe(), y.useDeprecatedSynchronousErrorHandling)) throw e;
          S(e);
        }
      }),
      (t.prototype.__tryOrSetError = function (e, t, r) {
        if (!y.useDeprecatedSynchronousErrorHandling) throw new Error("bad call");
        try {
          t.call(this._context, r);
        } catch (t) {
          return y.useDeprecatedSynchronousErrorHandling
            ? ((e.syncErrorValue = t), (e.syncErrorThrown = !0), !0)
            : (S(t), !0);
        }
        return !1;
      }),
      (t.prototype._unsubscribe = function () {
        var e = this._parentSubscriber;
        (this._context = null), (this._parentSubscriber = null), e.unsubscribe();
      }),
      t
    );
  })(C),
  w = (function (e) {
    function t() {
      return (null !== e && e.apply(this, arguments)) || this;
    }
    return (
      f(t, e),
      (t.prototype.notifyNext = function (e, t, r, n, o) {
        this.destination.next(t);
      }),
      (t.prototype.notifyError = function (e, t) {
        this.destination.error(e);
      }),
      (t.prototype.notifyComplete = function (e) {
        this.destination.complete();
      }),
      t
    );
  })(C),
  T = (function (e) {
    function t(t, r, n) {
      var o = e.call(this) || this;
      return (o.parent = t), (o.outerValue = r), (o.outerIndex = n), (o.index = 0), o;
    }
    return (
      f(t, e),
      (t.prototype._next = function (e) {
        this.parent.notifyNext(this.outerValue, e, this.outerIndex, this.index++, this);
      }),
      (t.prototype._error = function (e) {
        this.parent.notifyError(e, this), this.unsubscribe();
      }),
      (t.prototype._complete = function () {
        this.parent.notifyComplete(this), this.unsubscribe();
      }),
      t
    );
  })(C);
function P() {
  return "function" == typeof Symbol && Symbol.iterator ? Symbol.iterator : "@@iterator";
}
var R = P(),
  M = (function () {
    return ("function" == typeof Symbol && Symbol.observable) || "@@observable";
  })(),
  F = function (e) {
    return e && "number" == typeof e.length && "function" != typeof e;
  };
function O(e) {
  return !!e && "function" != typeof e.subscribe && "function" == typeof e.then;
}
var N = function (e) {
  if (e && "function" == typeof e[M])
    return (
      (o = e),
      function (e) {
        var t = o[M]();
        if ("function" != typeof t.subscribe)
          throw new TypeError("Provided object does not correctly implement Symbol.observable");
        return t.subscribe(e);
      }
    );
  if (F(e))
    return (
      (n = e),
      function (e) {
        for (var t = 0, r = n.length; t < r && !e.closed; t++) e.next(n[t]);
        e.complete();
      }
    );
  if (O(e))
    return (
      (r = e),
      function (e) {
        return (
          r
            .then(
              function (t) {
                e.closed || (e.next(t), e.complete());
              },
              function (t) {
                return e.error(t);
              },
            )
            .then(null, S),
          e
        );
      }
    );
  if (e && "function" == typeof e[R])
    return (
      (t = e),
      function (e) {
        for (var r = t[R](); ; ) {
          var n = r.next();
          if (n.done) {
            e.complete();
            break;
          }
          if ((e.next(n.value), e.closed)) break;
        }
        return (
          "function" == typeof r.return &&
            e.add(function () {
              r.return && r.return();
            }),
          e
        );
      }
    );
  var t,
    r,
    n,
    o,
    s = x(e) ? "an invalid object" : "'" + e + "'";
  throw new TypeError(
    "You provided " + s + " where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.",
  );
};
function L() {}
function B(e) {
  return e
    ? 1 === e.length
      ? e[0]
      : function (t) {
          return e.reduce(function (e, t) {
            return t(e);
          }, t);
        }
    : L;
}
var k = (function () {
  function e(e) {
    (this._isScalar = !1), e && (this._subscribe = e);
  }
  return (
    (e.prototype.lift = function (t) {
      var r = new e();
      return (r.source = this), (r.operator = t), r;
    }),
    (e.prototype.subscribe = function (e, t, r) {
      var n = this.operator,
        o = (function (e, t, r) {
          if (e) {
            if (e instanceof C) return e;
            if (e[g]) return e[g]();
          }
          return e || t || r ? new C(e, t, r) : new C(v);
        })(e, t, r);
      if (
        (n
          ? o.add(n.call(o, this.source))
          : o.add(
              this.source || (y.useDeprecatedSynchronousErrorHandling && !o.syncErrorThrowable)
                ? this._subscribe(o)
                : this._trySubscribe(o),
            ),
        y.useDeprecatedSynchronousErrorHandling &&
          o.syncErrorThrowable &&
          ((o.syncErrorThrowable = !1), o.syncErrorThrown))
      )
        throw o.syncErrorValue;
      return o;
    }),
    (e.prototype._trySubscribe = function (e) {
      try {
        return this._subscribe(e);
      } catch (t) {
        y.useDeprecatedSynchronousErrorHandling && ((e.syncErrorThrown = !0), (e.syncErrorValue = t)),
          !(function (e) {
            for (; e; ) {
              var t = e,
                r = t.closed,
                n = t.destination,
                o = t.isStopped;
              if (r || o) return !1;
              e = n && n instanceof C ? n : null;
            }
            return !0;
          })(e)
            ? console.warn(t)
            : e.error(t);
      }
    }),
    (e.prototype.forEach = function (e, t) {
      var r = this;
      return new (t = G(t))(function (t, n) {
        var o;
        o = r.subscribe(
          function (t) {
            try {
              e(t);
            } catch (e) {
              n(e), o && o.unsubscribe();
            }
          },
          n,
          t,
        );
      });
    }),
    (e.prototype._subscribe = function (e) {
      var t = this.source;
      return t && t.subscribe(e);
    }),
    (e.prototype[M] = function () {
      return this;
    }),
    (e.prototype.pipe = function () {
      for (var e = [], t = 0; t < arguments.length; t++) e[t] = arguments[t];
      return 0 === e.length ? this : B(e)(this);
    }),
    (e.prototype.toPromise = function (e) {
      var t = this;
      return new (e = G(e))(function (e, r) {
        var n;
        t.subscribe(
          function (e) {
            return (n = e);
          },
          function (e) {
            return r(e);
          },
          function () {
            return e(n);
          },
        );
      });
    }),
    (e.create = function (t) {
      return new e(t);
    }),
    e
  );
})();
function G(e) {
  if ((e || (e = Promise), !e)) throw new Error("no Promise impl found");
  return e;
}
function j(e, t, r, n, o) {
  if ((void 0 === o && (o = new T(e, r, n)), !o.closed)) return t instanceof k ? t.subscribe(o) : N(t)(o);
}
function U(e, t) {
  if (null != e) {
    if (
      (function (e) {
        return e && "function" == typeof e[M];
      })(e)
    )
      return (function (e, t) {
        return new k(function (r) {
          var n = new I();
          return (
            n.add(
              t.schedule(function () {
                var o = e[M]();
                n.add(
                  o.subscribe({
                    next: function (e) {
                      n.add(
                        t.schedule(function () {
                          return r.next(e);
                        }),
                      );
                    },
                    error: function (e) {
                      n.add(
                        t.schedule(function () {
                          return r.error(e);
                        }),
                      );
                    },
                    complete: function () {
                      n.add(
                        t.schedule(function () {
                          return r.complete();
                        }),
                      );
                    },
                  }),
                );
              }),
            ),
            n
          );
        });
      })(e, t);
    if (O(e))
      return (function (e, t) {
        return new k(function (r) {
          var n = new I();
          return (
            n.add(
              t.schedule(function () {
                return e.then(
                  function (e) {
                    n.add(
                      t.schedule(function () {
                        r.next(e),
                          n.add(
                            t.schedule(function () {
                              return r.complete();
                            }),
                          );
                      }),
                    );
                  },
                  function (e) {
                    n.add(
                      t.schedule(function () {
                        return r.error(e);
                      }),
                    );
                  },
                );
              }),
            ),
            n
          );
        });
      })(e, t);
    if (F(e))
      return (function (e, t) {
        return new k(function (r) {
          var n = new I(),
            o = 0;
          return (
            n.add(
              t.schedule(function () {
                o !== e.length ? (r.next(e[o++]), r.closed || n.add(this.schedule())) : r.complete();
              }),
            ),
            n
          );
        });
      })(e, t);
    if (
      (function (e) {
        return e && "function" == typeof e[R];
      })(e) ||
      "string" == typeof e
    )
      return (function (e, t) {
        if (!e) throw new Error("Iterable cannot be null");
        return new k(function (r) {
          var n,
            o = new I();
          return (
            o.add(function () {
              n && "function" == typeof n.return && n.return();
            }),
            o.add(
              t.schedule(function () {
                (n = e[R]()),
                  o.add(
                    t.schedule(function () {
                      if (!r.closed) {
                        var e, t;
                        try {
                          var o = n.next();
                          (e = o.value), (t = o.done);
                        } catch (e) {
                          return void r.error(e);
                        }
                        t ? r.complete() : (r.next(e), this.schedule());
                      }
                    }),
                  );
              }),
            ),
            o
          );
        });
      })(e, t);
  }
  throw new TypeError(((null !== e && typeof e) || e) + " is not observable");
}
function H(e, t) {
  return function (r) {
    if ("function" != typeof e) throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");
    return r.lift(new $(e, t));
  };
}
var $ = (function () {
    function e(e, t) {
      (this.project = e), (this.thisArg = t);
    }
    return (
      (e.prototype.call = function (e, t) {
        return t.subscribe(new W(e, this.project, this.thisArg));
      }),
      e
    );
  })(),
  W = (function (e) {
    function t(t, r, n) {
      var o = e.call(this, t) || this;
      return (o.project = r), (o.count = 0), (o.thisArg = n || o), o;
    }
    return (
      f(t, e),
      (t.prototype._next = function (e) {
        var t;
        try {
          t = this.project.call(this.thisArg, e, this.count++);
        } catch (e) {
          return void this.destination.error(e);
        }
        this.destination.next(t);
      }),
      t
    );
  })(C);
function Y(e, t) {
  return function (r) {
    return r.lift(new K(e, t));
  };
}
var K = (function () {
    function e(e, t) {
      (this.compare = e), (this.keySelector = t);
    }
    return (
      (e.prototype.call = function (e, t) {
        return t.subscribe(new J(e, this.compare, this.keySelector));
      }),
      e
    );
  })(),
  J = (function (e) {
    function t(t, r, n) {
      var o = e.call(this, t) || this;
      return (o.keySelector = n), (o.hasKey = !1), "function" == typeof r && (o.compare = r), o;
    }
    return (
      f(t, e),
      (t.prototype.compare = function (e, t) {
        return e === t;
      }),
      (t.prototype._next = function (e) {
        var t;
        try {
          var r = this.keySelector;
          t = r ? r(e) : e;
        } catch (e) {
          return this.destination.error(e);
        }
        var n = !1;
        if (this.hasKey)
          try {
            n = (0, this.compare)(this.key, t);
          } catch (e) {
            return this.destination.error(e);
          }
        else this.hasKey = !0;
        n || ((this.key = t), this.destination.next(e));
      }),
      t
    );
  })(C);
function q(e, t) {
  return function (r) {
    return r.lift(new V(e, t));
  };
}
var V = (function () {
    function e(e, t) {
      (this.predicate = e), (this.thisArg = t);
    }
    return (
      (e.prototype.call = function (e, t) {
        return t.subscribe(new Z(e, this.predicate, this.thisArg));
      }),
      e
    );
  })(),
  Z = (function (e) {
    function t(t, r, n) {
      var o = e.call(this, t) || this;
      return (o.predicate = r), (o.thisArg = n), (o.count = 0), o;
    }
    return (
      f(t, e),
      (t.prototype._next = function (e) {
        var t;
        try {
          t = this.predicate.call(this.thisArg, e, this.count++);
        } catch (e) {
          return void this.destination.error(e);
        }
        t && this.destination.next(e);
      }),
      t
    );
  })(C),
  X = (function () {
    function e() {
      return Error.call(this), (this.message = "object unsubscribed"), (this.name = "ObjectUnsubscribedError"), this;
    }
    return (e.prototype = Object.create(Error.prototype)), e;
  })(),
  z = (function (e) {
    function t(t, r) {
      var n = e.call(this) || this;
      return (n.subject = t), (n.subscriber = r), (n.closed = !1), n;
    }
    return (
      f(t, e),
      (t.prototype.unsubscribe = function () {
        if (!this.closed) {
          this.closed = !0;
          var e = this.subject,
            t = e.observers;
          if (((this.subject = null), t && 0 !== t.length && !e.isStopped && !e.closed)) {
            var r = t.indexOf(this.subscriber);
            -1 !== r && t.splice(r, 1);
          }
        }
      }),
      t
    );
  })(I),
  Q = (function (e) {
    function t(t) {
      var r = e.call(this, t) || this;
      return (r.destination = t), r;
    }
    return f(t, e), t;
  })(C),
  ee = (function (e) {
    function t() {
      var t = e.call(this) || this;
      return (t.observers = []), (t.closed = !1), (t.isStopped = !1), (t.hasError = !1), (t.thrownError = null), t;
    }
    return (
      f(t, e),
      (t.prototype[g] = function () {
        return new Q(this);
      }),
      (t.prototype.lift = function (e) {
        var t = new te(this, this);
        return (t.operator = e), t;
      }),
      (t.prototype.next = function (e) {
        if (this.closed) throw new X();
        if (!this.isStopped) for (var t = this.observers, r = t.length, n = t.slice(), o = 0; o < r; o++) n[o].next(e);
      }),
      (t.prototype.error = function (e) {
        if (this.closed) throw new X();
        (this.hasError = !0), (this.thrownError = e), (this.isStopped = !0);
        for (var t = this.observers, r = t.length, n = t.slice(), o = 0; o < r; o++) n[o].error(e);
        this.observers.length = 0;
      }),
      (t.prototype.complete = function () {
        if (this.closed) throw new X();
        this.isStopped = !0;
        for (var e = this.observers, t = e.length, r = e.slice(), n = 0; n < t; n++) r[n].complete();
        this.observers.length = 0;
      }),
      (t.prototype.unsubscribe = function () {
        (this.isStopped = !0), (this.closed = !0), (this.observers = null);
      }),
      (t.prototype._trySubscribe = function (t) {
        if (this.closed) throw new X();
        return e.prototype._trySubscribe.call(this, t);
      }),
      (t.prototype._subscribe = function (e) {
        if (this.closed) throw new X();
        return this.hasError
          ? (e.error(this.thrownError), I.EMPTY)
          : this.isStopped
          ? (e.complete(), I.EMPTY)
          : (this.observers.push(e), new z(this, e));
      }),
      (t.prototype.asObservable = function () {
        var e = new k();
        return (e.source = this), e;
      }),
      (t.create = function (e, t) {
        return new te(e, t);
      }),
      t
    );
  })(k),
  te = (function (e) {
    function t(t, r) {
      var n = e.call(this) || this;
      return (n.destination = t), (n.source = r), n;
    }
    return (
      f(t, e),
      (t.prototype.next = function (e) {
        var t = this.destination;
        t && t.next && t.next(e);
      }),
      (t.prototype.error = function (e) {
        var t = this.destination;
        t && t.error && this.destination.error(e);
      }),
      (t.prototype.complete = function () {
        var e = this.destination;
        e && e.complete && this.destination.complete();
      }),
      (t.prototype._subscribe = function (e) {
        return this.source ? this.source.subscribe(e) : I.EMPTY;
      }),
      t
    );
  })(ee);
var re = (function () {
    function e(e, t, r) {
      void 0 === r && (r = !1), (this.accumulator = e), (this.seed = t), (this.hasSeed = r);
    }
    return (
      (e.prototype.call = function (e, t) {
        return t.subscribe(new ne(e, this.accumulator, this.seed, this.hasSeed));
      }),
      e
    );
  })(),
  ne = (function (e) {
    function t(t, r, n, o) {
      var s = e.call(this, t) || this;
      return (s.accumulator = r), (s._seed = n), (s.hasSeed = o), (s.index = 0), s;
    }
    return (
      f(t, e),
      Object.defineProperty(t.prototype, "seed", {
        get: function () {
          return this._seed;
        },
        set: function (e) {
          (this.hasSeed = !0), (this._seed = e);
        },
        enumerable: !0,
        configurable: !0,
      }),
      (t.prototype._next = function (e) {
        if (this.hasSeed) return this._tryNext(e);
        (this.seed = e), this.destination.next(e);
      }),
      (t.prototype._tryNext = function (e) {
        var t,
          r = this.index++;
        try {
          t = this.accumulator(this.seed, e, r);
        } catch (e) {
          this.destination.error(e);
        }
        (this.seed = t), this.destination.next(t);
      }),
      t
    );
  })(C);
function oe() {
  return function (e) {
    return e.lift(new se(e));
  };
}
var se = (function () {
    function e(e) {
      this.connectable = e;
    }
    return (
      (e.prototype.call = function (e, t) {
        var r = this.connectable;
        r._refCount++;
        var n = new ie(e, r),
          o = t.subscribe(n);
        return n.closed || (n.connection = r.connect()), o;
      }),
      e
    );
  })(),
  ie = (function (e) {
    function t(t, r) {
      var n = e.call(this, t) || this;
      return (n.connectable = r), n;
    }
    return (
      f(t, e),
      (t.prototype._unsubscribe = function () {
        var e = this.connectable;
        if (e) {
          this.connectable = null;
          var t = e._refCount;
          if (t <= 0) this.connection = null;
          else if (((e._refCount = t - 1), t > 1)) this.connection = null;
          else {
            var r = this.connection,
              n = e._connection;
            (this.connection = null), !n || (r && n !== r) || n.unsubscribe();
          }
        } else this.connection = null;
      }),
      t
    );
  })(C),
  ae = (function (e) {
    function t(t, r) {
      var n = e.call(this) || this;
      return (n.source = t), (n.subjectFactory = r), (n._refCount = 0), (n._isComplete = !1), n;
    }
    return (
      f(t, e),
      (t.prototype._subscribe = function (e) {
        return this.getSubject().subscribe(e);
      }),
      (t.prototype.getSubject = function () {
        var e = this._subject;
        return (e && !e.isStopped) || (this._subject = this.subjectFactory()), this._subject;
      }),
      (t.prototype.connect = function () {
        var e = this._connection;
        return (
          e ||
            ((this._isComplete = !1),
            (e = this._connection = new I()).add(this.source.subscribe(new ue(this.getSubject(), this))),
            e.closed && ((this._connection = null), (e = I.EMPTY))),
          e
        );
      }),
      (t.prototype.refCount = function () {
        return oe()(this);
      }),
      t
    );
  })(k),
  ce = (function () {
    var e = ae.prototype;
    return {
      operator: { value: null },
      _refCount: { value: 0, writable: !0 },
      _subject: { value: null, writable: !0 },
      _connection: { value: null, writable: !0 },
      _subscribe: { value: e._subscribe },
      _isComplete: { value: e._isComplete, writable: !0 },
      getSubject: { value: e.getSubject },
      connect: { value: e.connect },
      refCount: { value: e.refCount },
    };
  })(),
  ue = (function (e) {
    function t(t, r) {
      var n = e.call(this, t) || this;
      return (n.connectable = r), n;
    }
    return (
      f(t, e),
      (t.prototype._error = function (t) {
        this._unsubscribe(), e.prototype._error.call(this, t);
      }),
      (t.prototype._complete = function () {
        (this.connectable._isComplete = !0), this._unsubscribe(), e.prototype._complete.call(this);
      }),
      (t.prototype._unsubscribe = function () {
        var e = this.connectable;
        if (e) {
          this.connectable = null;
          var t = e._connection;
          (e._refCount = 0), (e._subject = null), (e._connection = null), t && t.unsubscribe();
        }
      }),
      t
    );
  })(Q);
var pe = (function () {
  function e(e, t) {
    (this.subjectFactory = e), (this.selector = t);
  }
  return (
    (e.prototype.call = function (e, t) {
      var r = this.selector,
        n = this.subjectFactory(),
        o = r(n).subscribe(e);
      return o.add(t.subscribe(n)), o;
    }),
    e
  );
})();
var le = (function () {
    function e() {}
    return (
      (e.prototype.call = function (e, t) {
        return t.subscribe(new he(e));
      }),
      e
    );
  })(),
  he = (function (e) {
    function t(t) {
      var r = e.call(this, t) || this;
      return (r.hasPrev = !1), r;
    }
    return (
      f(t, e),
      (t.prototype._next = function (e) {
        var t;
        this.hasPrev ? (t = [this.prev, e]) : (this.hasPrev = !0), (this.prev = e), t && this.destination.next(t);
      }),
      t
    );
  })(C);
var de = (function () {
    function e(e) {
      this.notifier = e;
    }
    return (
      (e.prototype.call = function (e, t) {
        return t.subscribe(new fe(e, this.notifier, t));
      }),
      e
    );
  })(),
  fe = (function (e) {
    function t(t, r, n) {
      var o = e.call(this, t) || this;
      return (o.notifier = r), (o.source = n), (o.sourceIsBeingSubscribedTo = !0), o;
    }
    return (
      f(t, e),
      (t.prototype.notifyNext = function (e, t, r, n, o) {
        (this.sourceIsBeingSubscribedTo = !0), this.source.subscribe(this);
      }),
      (t.prototype.notifyComplete = function (t) {
        if (!1 === this.sourceIsBeingSubscribedTo) return e.prototype.complete.call(this);
      }),
      (t.prototype.complete = function () {
        if (((this.sourceIsBeingSubscribedTo = !1), !this.isStopped)) {
          if ((this.retries || this.subscribeToRetries(), !this.retriesSubscription || this.retriesSubscription.closed))
            return e.prototype.complete.call(this);
          this._unsubscribeAndRecycle(), this.notifications.next();
        }
      }),
      (t.prototype._unsubscribe = function () {
        var e = this.notifications,
          t = this.retriesSubscription;
        e && (e.unsubscribe(), (this.notifications = null)),
          t && (t.unsubscribe(), (this.retriesSubscription = null)),
          (this.retries = null);
      }),
      (t.prototype._unsubscribeAndRecycle = function () {
        var t = this._unsubscribe;
        return (this._unsubscribe = null), e.prototype._unsubscribeAndRecycle.call(this), (this._unsubscribe = t), this;
      }),
      (t.prototype.subscribeToRetries = function () {
        var t;
        this.notifications = new ee();
        try {
          t = (0, this.notifier)(this.notifications);
        } catch (t) {
          return e.prototype.complete.call(this);
        }
        (this.retries = t), (this.retriesSubscription = j(this, t));
      }),
      t
    );
  })(w);
function me() {
  return new ee();
}
function be() {
  return function (e) {
    return oe()(
      ((t = me),
      function (e) {
        var n;
        if (
          ((n =
            "function" == typeof t
              ? t
              : function () {
                  return t;
                }),
          "function" == typeof r)
        )
          return e.lift(new pe(n, r));
        var o = Object.create(e, ce);
        return (o.source = e), (o.subjectFactory = n), o;
      })(e),
    );
    var t, r;
  };
}
function ye(e, t) {
  return "function" == typeof t
    ? function (r) {
        return r.pipe(
          ye(function (r, n) {
            return ((o = e(r, n)), s ? U(o, s) : o instanceof k ? o : new k(N(o))).pipe(
              H(function (e, o) {
                return t(r, e, n, o);
              }),
            );
            var o, s;
          }),
        );
      }
    : function (t) {
        return t.lift(new Se(e));
      };
}
var Se = (function () {
    function e(e) {
      this.project = e;
    }
    return (
      (e.prototype.call = function (e, t) {
        return t.subscribe(new ve(e, this.project));
      }),
      e
    );
  })(),
  ve = (function (e) {
    function t(t, r) {
      var n = e.call(this, t) || this;
      return (n.project = r), (n.index = 0), n;
    }
    return (
      f(t, e),
      (t.prototype._next = function (e) {
        var t,
          r = this.index++;
        try {
          t = this.project(e, r);
        } catch (e) {
          return void this.destination.error(e);
        }
        this._innerSub(t, e, r);
      }),
      (t.prototype._innerSub = function (e, t, r) {
        var n = this.innerSubscription;
        n && n.unsubscribe();
        var o = new T(this, t, r),
          s = this.destination;
        s.add(o),
          (this.innerSubscription = j(this, e, void 0, void 0, o)),
          this.innerSubscription !== o && s.add(this.innerSubscription);
      }),
      (t.prototype._complete = function () {
        var t = this.innerSubscription;
        (t && !t.closed) || e.prototype._complete.call(this), this.unsubscribe();
      }),
      (t.prototype._unsubscribe = function () {
        this.innerSubscription = null;
      }),
      (t.prototype.notifyComplete = function (t) {
        this.destination.remove(t), (this.innerSubscription = null), this.isStopped && e.prototype._complete.call(this);
      }),
      (t.prototype.notifyNext = function (e, t, r, n, o) {
        this.destination.next(t);
      }),
      t
    );
  })(w);
function _e(e) {
  return function (t) {
    return t.lift(new xe(e));
  };
}
var xe = (function () {
    function e(e) {
      this.notifier = e;
    }
    return (
      (e.prototype.call = function (e, t) {
        var r = new Ee(e),
          n = j(r, this.notifier);
        return n && !r.seenValue ? (r.add(n), t.subscribe(r)) : r;
      }),
      e
    );
  })(),
  Ee = (function (e) {
    function t(t) {
      var r = e.call(this, t) || this;
      return (r.seenValue = !1), r;
    }
    return (
      f(t, e),
      (t.prototype.notifyNext = function (e, t, r, n, o) {
        (this.seenValue = !0), this.complete();
      }),
      (t.prototype.notifyComplete = function () {}),
      t
    );
  })(w);
function Ie() {
  for (var e = [], t = 0; t < arguments.length; t++) e[t] = arguments[t];
  return function (t) {
    var r;
    "function" == typeof e[e.length - 1] && (r = e.pop());
    var n = e;
    return t.lift(new Ae(n, r));
  };
}
var Ae = (function () {
    function e(e, t) {
      (this.observables = e), (this.project = t);
    }
    return (
      (e.prototype.call = function (e, t) {
        return t.subscribe(new ge(e, this.observables, this.project));
      }),
      e
    );
  })(),
  ge = (function (e) {
    function t(t, r, n) {
      var o = e.call(this, t) || this;
      (o.observables = r), (o.project = n), (o.toRespond = []);
      var s = r.length;
      o.values = new Array(s);
      for (var i = 0; i < s; i++) o.toRespond.push(i);
      for (i = 0; i < s; i++) {
        var a = r[i];
        o.add(j(o, a, a, i));
      }
      return o;
    }
    return (
      f(t, e),
      (t.prototype.notifyNext = function (e, t, r, n, o) {
        this.values[r] = t;
        var s = this.toRespond;
        if (s.length > 0) {
          var i = s.indexOf(r);
          -1 !== i && s.splice(i, 1);
        }
      }),
      (t.prototype.notifyComplete = function () {}),
      (t.prototype._next = function (e) {
        if (0 === this.toRespond.length) {
          var t = [e].concat(this.values);
          this.project ? this._tryProject(t) : this.destination.next(t);
        }
      }),
      (t.prototype._tryProject = function (e) {
        var t;
        try {
          t = this.project.apply(this, e);
        } catch (e) {
          return void this.destination.error(e);
        }
        this.destination.next(t);
      }),
      t
    );
  })(w);
const Ce = [0, 1, 2, 3];
function De(e, t) {
  return (r) => r.pipe(q((r) => we(r.playerIndex, e, t)));
}
const we = (e, t, r) => {
    let n = [...Ce];
    if ("number" == typeof t) n = [t];
    else if ("string" == typeof t) {
      if (r && void 0 !== r.playerIndex)
        switch (t) {
          case "player":
            n = [r.playerIndex];
            break;
          case "opponents":
            n = Ce.filter((e) => e !== r.playerIndex);
        }
    } else n = t;
    return n.includes(e);
  },
  Te = (e, t) => {
    const r = e.events
      .filter((e) => e.type === exports.GameEvent.GAME_START)
      .map((e) => {
        let r = t;
        const n = e.filter;
        return (
          n &&
            (void 0 !== n.numPlayers && (r = r.pipe(q((e) => e.players.length === n.numPlayers))),
            void 0 !== n.isTeams && (r = r.pipe(q((e) => e.isTeams === n.isTeams)))),
          r.pipe(H((t) => ({ id: e.id, type: e.type, payload: t })))
        );
      });
    return n.merge(...r);
  },
  Pe = (e, t) => {
    const r = e.events
      .filter((e) => e.type === exports.GameEvent.GAME_END)
      .map((r) => {
        let n = t;
        const o = r.filter;
        return (
          o &&
            (void 0 !== o.endMethod && (n = n.pipe(q((e) => e.gameEndMethod === o.endMethod))),
            void 0 !== o.winnerPlayerIndex &&
              (n = n.pipe(q((t) => we(t.winnerPlayerIndex, o.winnerPlayerIndex, e.variables))))),
          n.pipe(H((e) => ({ id: r.id, type: r.type, payload: e })))
        );
      });
    return n.merge(...r);
  };
var Re, Me;
function Fe(e) {
  return (t) => t.pipe(q((t) => Object.keys(t.players).includes(e.toString())));
}
function Oe() {
  return (e) =>
    e.pipe(
      function (e) {
        return e.lift(new le());
      },
      q(([e, t]) => t.frame > e.frame),
    );
}
function Ne() {
  return (e) => e.pipe(q((e) => e.frame === o.Frames.FIRST));
}
function Le(e) {
  return (t) => {
    const r = t.pipe(Fe(e), Ne()),
      s = t.pipe(
        Fe(e),
        Oe(),
        q(([t, r]) => {
          const n = t.players[e].post.actionStateId,
            s = r.players[e].post.actionStateId;
          return o.isDead(n) && !o.isDead(s);
        }),
        H(([e, t]) => t),
      );
    return n.merge(r, s);
  };
}
function Be(e, t) {
  return (r) =>
    r.pipe(
      Ie(e),
      H(([e, r]) => {
        const n = r.players.find((e) => e.playerIndex === t),
          o = r.players.find((e) => e.playerIndex !== t);
        return {
          playerIndex: n.playerIndex,
          opponentIndex: o.playerIndex,
          startFrame: e.frame,
          endFrame: null,
          startPercent: 0,
          endPercent: null,
          currentPercent: 0,
          count: e.stocksRemaining,
          deathAnimation: null,
        };
      }),
    );
}
function ke(e) {
  return (t) =>
    t.pipe(
      Ie(e),
      H(([[e, t], r]) => ({
        ...r,
        endFrame: t.frame,
        endPercent: e.percent || 0,
        currentPercent: e.percent || 0,
        deathAnimation: t.actionStateId,
      })),
    );
}
((Re = exports.GameEndMethod || (exports.GameEndMethod = {}))[(Re.UNRESOLVED = 0)] = "UNRESOLVED"),
  (Re[(Re.TIME = 1)] = "TIME"),
  (Re[(Re.GAME = 2)] = "GAME"),
  (Re[(Re.RESOLVED = 3)] = "RESOLVED"),
  (Re[(Re.NO_CONTEST = 7)] = "NO_CONTEST"),
  ((Me = exports.Input || (exports.Input = {})).D_LEFT = "D_LEFT"),
  (Me.D_RIGHT = "D_RIGHT"),
  (Me.D_DOWN = "D_DOWN"),
  (Me.D_UP = "D_UP"),
  (Me.Z = "Z"),
  (Me.R = "R"),
  (Me.L = "L"),
  (Me.A = "A"),
  (Me.B = "B"),
  (Me.X = "X"),
  (Me.Y = "Y"),
  (Me.START = "START");
const Ge = new Map()
  .set(o.Character.CAPTAIN_FALCON, {
    id: o.Character.CAPTAIN_FALCON,
    name: "Captain Falcon",
    shortName: "Falcon",
    colors: ["Default", "Black", "Red", "White", "Green", "Blue"],
  })
  .set(o.Character.DONKEY_KONG, {
    id: o.Character.DONKEY_KONG,
    name: "Donkey Kong",
    shortName: "DK",
    colors: ["Default", "Black", "Red", "Blue", "Green"],
  })
  .set(o.Character.FOX, { id: o.Character.FOX, name: "Fox", colors: ["Default", "Red", "Blue", "Green"] })
  .set(o.Character.GAME_AND_WATCH, {
    id: o.Character.GAME_AND_WATCH,
    name: "Mr. Game & Watch",
    shortName: "GnW",
    colors: ["Default", "Red", "Blue", "Green"],
  })
  .set(o.Character.KIRBY, {
    id: o.Character.KIRBY,
    name: "Kirby",
    colors: ["Default", "Yellow", "Blue", "Red", "Green", "White"],
  })
  .set(o.Character.BOWSER, { id: o.Character.BOWSER, name: "Bowser", colors: ["Default", "Red", "Blue", "Black"] })
  .set(o.Character.LINK, { id: o.Character.LINK, name: "Link", colors: ["Default", "Red", "Blue", "Black", "White"] })
  .set(o.Character.LUIGI, { id: o.Character.LUIGI, name: "Luigi", colors: ["Default", "White", "Blue", "Red"] })
  .set(o.Character.MARIO, {
    id: o.Character.MARIO,
    name: "Mario",
    colors: ["Default", "Yellow", "Black", "Blue", "Green"],
  })
  .set(o.Character.MARTH, {
    id: o.Character.MARTH,
    name: "Marth",
    colors: ["Default", "Red", "Green", "Black", "White"],
  })
  .set(o.Character.MEWTWO, { id: o.Character.MEWTWO, name: "Mewtwo", colors: ["Default", "Red", "Blue", "Green"] })
  .set(o.Character.NESS, { id: o.Character.NESS, name: "Ness", colors: ["Default", "Yellow", "Blue", "Green"] })
  .set(o.Character.PEACH, {
    id: o.Character.PEACH,
    name: "Peach",
    colors: ["Default", "Daisy", "White", "Blue", "Green"],
  })
  .set(o.Character.PIKACHU, {
    id: o.Character.PIKACHU,
    name: "Pikachu",
    colors: ["Default", "Red", "Party Hat", "Cowboy Hat"],
  })
  .set(o.Character.ICE_CLIMBERS, {
    id: o.Character.ICE_CLIMBERS,
    name: "Ice Climbers",
    shortName: "ICs",
    colors: ["Default", "Green", "Orange", "Red"],
  })
  .set(o.Character.JIGGLYPUFF, {
    id: o.Character.JIGGLYPUFF,
    name: "Jigglypuff",
    shortName: "Puff",
    colors: ["Default", "Red", "Blue", "Headband", "Crown"],
  })
  .set(o.Character.SAMUS, {
    id: o.Character.SAMUS,
    name: "Samus",
    colors: ["Default", "Pink", "Black", "Green", "Purple"],
  })
  .set(o.Character.YOSHI, {
    id: o.Character.YOSHI,
    name: "Yoshi",
    colors: ["Default", "Red", "Blue", "Yellow", "Pink", "Cyan"],
  })
  .set(o.Character.ZELDA, {
    id: o.Character.ZELDA,
    name: "Zelda",
    colors: ["Default", "Red", "Blue", "Green", "White"],
  })
  .set(o.Character.SHEIK, {
    id: o.Character.SHEIK,
    name: "Sheik",
    colors: ["Default", "Red", "Blue", "Green", "White"],
  })
  .set(o.Character.FALCO, { id: o.Character.FALCO, name: "Falco", colors: ["Default", "Red", "Blue", "Green"] })
  .set(o.Character.YOUNG_LINK, {
    id: o.Character.YOUNG_LINK,
    name: "Young Link",
    shortName: "YL",
    colors: ["Default", "Red", "Blue", "White", "Black"],
  })
  .set(o.Character.DR_MARIO, {
    id: o.Character.DR_MARIO,
    name: "Dr. Mario",
    shortName: "Doc",
    colors: ["Default", "Red", "Blue", "Green", "Black"],
  })
  .set(o.Character.ROY, { id: o.Character.ROY, name: "Roy", colors: ["Default", "Red", "Blue", "Green", "Yellow"] })
  .set(o.Character.PICHU, { id: o.Character.PICHU, name: "Pichu", colors: ["Default", "Red", "Blue", "Green"] })
  .set(o.Character.GANONDORF, {
    id: o.Character.GANONDORF,
    name: "Ganondorf",
    shortName: "Ganon",
    colors: ["Default", "Red", "Blue", "Green", "Purple"],
  });
function je(e) {
  const t = Ge.get(e);
  if (!t) throw new Error("Invalid character id: " + e);
  return t;
}
function Ue(e) {
  return je(e).name;
}
const He = { id: -1, name: "Unknown Move", shortName: "unknown" };
var $e;
(($e = exports.MoveID || (exports.MoveID = {}))[($e.MISC = 1)] = "MISC"),
  ($e[($e.JAB_1 = 2)] = "JAB_1"),
  ($e[($e.JAB_2 = 3)] = "JAB_2"),
  ($e[($e.JAB_3 = 4)] = "JAB_3"),
  ($e[($e.RAPID_JABS = 5)] = "RAPID_JABS"),
  ($e[($e.DASH_ATTACK = 6)] = "DASH_ATTACK"),
  ($e[($e.F_TILT = 7)] = "F_TILT"),
  ($e[($e.U_TILT = 8)] = "U_TILT"),
  ($e[($e.D_TILT = 9)] = "D_TILT"),
  ($e[($e.F_SMASH = 10)] = "F_SMASH"),
  ($e[($e.U_SMASH = 11)] = "U_SMASH"),
  ($e[($e.D_SMASH = 12)] = "D_SMASH"),
  ($e[($e.NEUTRAL_AIR = 13)] = "NEUTRAL_AIR"),
  ($e[($e.F_AIR = 14)] = "F_AIR"),
  ($e[($e.B_AIR = 15)] = "B_AIR"),
  ($e[($e.U_AIR = 16)] = "U_AIR"),
  ($e[($e.D_AIR = 17)] = "D_AIR"),
  ($e[($e.NEUTRAL_SPECIAL = 18)] = "NEUTRAL_SPECIAL"),
  ($e[($e.F_SPECIAL = 19)] = "F_SPECIAL"),
  ($e[($e.U_SPECIAL = 20)] = "U_SPECIAL"),
  ($e[($e.D_SPECIAL = 21)] = "D_SPECIAL"),
  ($e[($e.GETUP = 50)] = "GETUP"),
  ($e[($e.GETUP_SLOW = 51)] = "GETUP_SLOW"),
  ($e[($e.GRAB_PUMMEL = 52)] = "GRAB_PUMMEL"),
  ($e[($e.F_THROW = 53)] = "F_THROW"),
  ($e[($e.B_THROW = 54)] = "B_THROW"),
  ($e[($e.U_THROW = 55)] = "U_THROW"),
  ($e[($e.D_THROW = 56)] = "D_THROW"),
  ($e[($e.EDGE_SLOW = 61)] = "EDGE_SLOW"),
  ($e[($e.EDGE = 62)] = "EDGE");
const We = new Map()
  .set(exports.MoveID.MISC, { id: exports.MoveID.MISC, name: "Miscellaneous", shortName: "misc" })
  .set(exports.MoveID.JAB_1, { id: exports.MoveID.JAB_1, name: "Jab", shortName: "jab" })
  .set(exports.MoveID.JAB_2, { id: exports.MoveID.JAB_2, name: "Jab", shortName: "jab" })
  .set(exports.MoveID.JAB_3, { id: exports.MoveID.JAB_3, name: "Jab", shortName: "jab" })
  .set(exports.MoveID.RAPID_JABS, { id: exports.MoveID.RAPID_JABS, name: "Rapid Jabs", shortName: "rapid-jabs" })
  .set(exports.MoveID.DASH_ATTACK, { id: exports.MoveID.DASH_ATTACK, name: "Dash Attack", shortName: "dash" })
  .set(exports.MoveID.F_TILT, { id: exports.MoveID.F_TILT, name: "Forward Tilt", shortName: "ftilt" })
  .set(exports.MoveID.U_TILT, { id: exports.MoveID.U_TILT, name: "Up Tilt", shortName: "utilt" })
  .set(exports.MoveID.D_TILT, { id: exports.MoveID.D_TILT, name: "Down Tilt", shortName: "dtilt" })
  .set(exports.MoveID.F_SMASH, { id: exports.MoveID.F_SMASH, name: "Forward Smash", shortName: "fsmash" })
  .set(exports.MoveID.U_SMASH, { id: exports.MoveID.U_SMASH, name: "Up Smash", shortName: "usmash" })
  .set(exports.MoveID.D_SMASH, { id: exports.MoveID.D_SMASH, name: "Down Smash", shortName: "dsmash" })
  .set(exports.MoveID.NEUTRAL_AIR, { id: exports.MoveID.NEUTRAL_AIR, name: "Neutral Air", shortName: "nair" })
  .set(exports.MoveID.F_AIR, { id: exports.MoveID.F_AIR, name: "Forward Air", shortName: "fair" })
  .set(exports.MoveID.B_AIR, { id: exports.MoveID.B_AIR, name: "Back Air", shortName: "bair" })
  .set(exports.MoveID.U_AIR, { id: exports.MoveID.U_AIR, name: "Up Air", shortName: "uair" })
  .set(exports.MoveID.D_AIR, { id: exports.MoveID.D_AIR, name: "Down Air", shortName: "dair" })
  .set(exports.MoveID.NEUTRAL_SPECIAL, {
    id: exports.MoveID.NEUTRAL_SPECIAL,
    name: "Neutral B",
    shortName: "neutral-b",
  })
  .set(exports.MoveID.F_SPECIAL, { id: exports.MoveID.F_SPECIAL, name: "Side B", shortName: "side-b" })
  .set(exports.MoveID.U_SPECIAL, { id: exports.MoveID.U_SPECIAL, name: "Up B", shortName: "up-b" })
  .set(exports.MoveID.D_SPECIAL, { id: exports.MoveID.D_SPECIAL, name: "Down B", shortName: "down-b" })
  .set(exports.MoveID.GETUP, { id: exports.MoveID.GETUP, name: "Getup Attack", shortName: "getup" })
  .set(exports.MoveID.GETUP_SLOW, {
    id: exports.MoveID.GETUP_SLOW,
    name: "Getup Attack (Slow)",
    shortName: "getup-slow",
  })
  .set(exports.MoveID.GRAB_PUMMEL, { id: exports.MoveID.GRAB_PUMMEL, name: "Grab Pummel", shortName: "pummel" })
  .set(exports.MoveID.F_THROW, { id: 53, name: "Forward Throw", shortName: "fthrow" })
  .set(exports.MoveID.B_THROW, { id: exports.MoveID.B_THROW, name: "Back Throw", shortName: "bthrow" })
  .set(exports.MoveID.U_THROW, { id: exports.MoveID.U_THROW, name: "Up Throw", shortName: "uthrow" })
  .set(exports.MoveID.D_THROW, { id: exports.MoveID.D_THROW, name: "Down Throw", shortName: "dthrow" })
  .set(exports.MoveID.EDGE_SLOW, { id: exports.MoveID.EDGE_SLOW, name: "Edge Attack (Slow)", shortName: "edge-slow" })
  .set(exports.MoveID.EDGE, { id: exports.MoveID.EDGE, name: "Edge Attack", shortName: "edge" });
function Ye(e) {
  const t = We.get(e);
  return t || He;
}
const Ke = new Map()
  .set(o.Stage.FOUNTAIN_OF_DREAMS, "FoD")
  .set(o.Stage.POKEMON_STADIUM, "PS")
  .set(o.Stage.YOSHIS_STORY, "YS")
  .set(o.Stage.DREAMLAND, "DL")
  .set(o.Stage.BATTLEFIELD, "BF")
  .set(o.Stage.FINAL_DESTINATION, "FD");
function Je(e) {
  const t = o.stages.getStageInfo(e);
  if (!t) throw new Error("Invalid stage with id " + e);
  const r = Ke.get(e);
  return { ...t, shortName: r };
}
function qe(e) {
  return Je(e).name;
}
function Ve(e, t, r) {
  const n = [];
  let o = e.players.map((e) => e.playerIndex);
  void 0 !== r && (o = [r]);
  for (const r of o) {
    const o = e.players.find((e) => e.playerIndex === r),
      i = o ? o.nametag : null,
      a = s.get(t, ["players", r, "names", "netplay"], null),
      c = s.get(t, ["players", r, "names", "code"], null);
    a && n.push(a), c && n.push(c), i && n.push(i);
  }
  return n;
}
function Ze(e, t, r) {
  if (0 === e.length || 0 === t.length) return !1;
  return (
    void 0 !==
    t.find((t) => {
      if (!r) return e.includes(t);
      const n = t.toLowerCase();
      return (
        void 0 !==
        e.find((e) => {
          const t = e.toLowerCase(),
            r = e.split(" ").join("_").toLowerCase();
          return t === n || r === n;
        })
      );
    })
  );
}
const Xe = (e, t, r) => {
    const n = t.players.find((t) => t.playerIndex === e.playerIndex);
    return r.portFilter.includes(n.port);
  },
  ze = (e, t, r, n) => {
    if (0 === r.nameTags.length) return !0;
    const o = Ve(t, n, e.playerIndex);
    return 0 !== o.length && Ze(r.nameTags, o, r.fuzzyNameTagMatching);
  },
  Qe = (e, t, r) => {
    if (0 === r.characterFilter.length) return !0;
    const n = t.players.find((t) => t.playerIndex === e.playerIndex);
    return r.characterFilter.includes(n.characterId);
  },
  et = (e, t, r) => {
    if (!r.excludeChainGrabs) return !0;
    const n = t.players.find((t) => t.playerIndex === e.playerIndex);
    if (!r.chainGrabbers.includes(n.characterId)) return !0;
    return !(
      e.moves.filter(({ moveId: e }) => e === exports.MoveID.U_THROW || e === exports.MoveID.GRAB_PUMMEL).length /
        e.moves.length >=
      r.chainGrabThreshold
    );
  },
  tt = (e, t, r) => {
    if (!r.excludeWobbles) return !0;
    if (t.players.find((t) => t.playerIndex === e.playerIndex).characterId !== o.Character.ICE_CLIMBERS) return !0;
    const n = [];
    let s = 0;
    e.moves.forEach(({ moveId: e }) => {
      e === exports.MoveID.GRAB_PUMMEL ? s++ : (n.push(s), (s = 0));
    }),
      n.push(s);
    return !n.some((e) => e > r.wobbleThreshold);
  },
  rt = (e, t, r) => e.moves.length >= r.minComboLength,
  nt = (e, t, r) => {
    const n = t.players.find((t) => t.playerIndex === e.playerIndex),
      o = r.perCharacterMinComboPercent[n.characterId] || r.minComboPercent;
    return e.endPercent - e.startPercent > o;
  },
  ot = (e, t, r) => {
    const n = s.sumBy(e.moves, ({ damage: e }) => e);
    return !e.moves.some(({ damage: e }) => e / n >= r.largeHitThreshold);
  },
  st = (e, t, r) => {
    if (!r.excludeCPUs) return !0;
    return !t.players.some((e) => 0 != e.type);
  },
  it = (e, t) => 2 === t.players.length,
  at = (e, t, r) => !r.comboMustKill || e.didKill,
  ct = [Xe, ze, Qe, et, tt, rt, nt, ot, st, it, at],
  ut = {
    chainGrabbers: [o.Character.MARTH, o.Character.PEACH, o.Character.PIKACHU, o.Character.DR_MARIO],
    characterFilter: [],
    portFilter: [1, 2, 3, 4],
    nameTags: [],
    minComboLength: 1,
    minComboPercent: 60,
    comboMustKill: !0,
    excludeCPUs: !0,
    excludeChainGrabs: !0,
    excludeWobbles: !0,
    largeHitThreshold: 0.8,
    wobbleThreshold: 8,
    chainGrabThreshold: 0.8,
    perCharacterMinComboPercent: { [o.Character.JIGGLYPUFF]: 85 },
    fuzzyNameTagMatching: !0,
  };
const pt = (e, t, r, n, o) => {
  const s = o && o.length > 0 ? o : [...ct];
  for (const o of s) if (!o(t, r, e, n)) return !1;
  return !0;
};
var lt;
!(function (e) {
  (e[(e.D_LEFT = 1)] = "D_LEFT"),
    (e[(e.D_RIGHT = 2)] = "D_RIGHT"),
    (e[(e.D_DOWN = 4)] = "D_DOWN"),
    (e[(e.D_UP = 8)] = "D_UP"),
    (e[(e.Z = 16)] = "Z"),
    (e[(e.R = 32)] = "R"),
    (e[(e.L = 64)] = "L"),
    (e[(e.A = 256)] = "A"),
    (e[(e.B = 512)] = "B"),
    (e[(e.X = 1024)] = "X"),
    (e[(e.Y = 2048)] = "Y"),
    (e[(e.START = 4096)] = "START");
})(lt || (lt = {}));
const ht = new Map()
    .set(exports.Input.D_LEFT, lt.D_LEFT)
    .set(exports.Input.D_RIGHT, lt.D_RIGHT)
    .set(exports.Input.D_DOWN, lt.D_DOWN)
    .set(exports.Input.D_UP, lt.D_UP)
    .set(exports.Input.Z, lt.Z)
    .set(exports.Input.R, lt.R)
    .set(exports.Input.L, lt.L)
    .set(exports.Input.A, lt.A)
    .set(exports.Input.B, lt.B)
    .set(exports.Input.X, lt.X)
    .set(exports.Input.Y, lt.Y)
    .set(exports.Input.START, lt.START),
  dt = (...e) => ((...e) => e.reduce((e, t) => e | t))(...e.map((e) => ft(e))),
  ft = (e) => {
    const t = ht.get(e);
    if (!t) throw new Error("Unknown input: " + e);
    return t;
  },
  mt = (e) => {
    const t = new Array();
    return (
      ht.forEach((r, n) => {
        ((e, t) => (e & t) === t)(e, r) && t.push(n);
      }),
      t
    );
  };
var bt, yt;
!(function (e) {
  (e.FILE_PATH = "[FILE_PATH]"),
    (e.LRAS = "[LRAS]"),
    (e.PLAYBACK_START_FRAME = "[PLAYBACK_START_FRAME]"),
    (e.GAME_END_FRAME = "[GAME_END_FRAME]"),
    (e.PLAYBACK_END_FRAME = "[PLAYBACK_END_FRAME]"),
    (e.CURRENT_FRAME = "[CURRENT_FRAME]"),
    (e.NO_GAME = "[NO_GAME]");
})(bt || (bt = {})),
  ((yt = exports.DolphinPlaybackStatus || (exports.DolphinPlaybackStatus = {})).FILE_LOADED = "FILE_LOADED"),
  (yt.PLAYBACK_START = "PLAYBACK_START"),
  (yt.PLAYBACK_END = "PLAYBACK_END"),
  (yt.QUEUE_EMPTY = "QUEUE_EMPTY");
const St = { startBuffer: 1, endBuffer: 1 },
  vt = o.Frames.FIRST - 1,
  _t = {
    gameEnded: !1,
    forceQuit: !1,
    currentFrame: vt,
    lastGameFrame: vt,
    startPlaybackFrame: vt,
    endPlaybackFrame: vt,
  };
class xt extends c.Writable {
  constructor(e, t) {
    super(t),
      (this.streamEndedSource = new n.Subject()),
      (this.playbackStatusSource = new n.Subject()),
      (this.playbackStatus$ = this.playbackStatusSource.asObservable().pipe(_e(this.streamEndedSource))),
      (this.buffers = Object.assign({}, St, e)),
      (this.state = Object.assign({}, _t)),
      this.on("finish", () => {
        this.streamEndedSource.next();
      });
  }
  setBuffer(e) {
    this.buffers = Object.assign(this.buffers, e);
  }
  _write(e, t, r) {
    if ("buffer" !== t) throw new Error(`Unsupported stream encoding. Expected 'buffer' got '${t}'.`);
    e
      .toString()
      .split(a.EOL)
      .filter((e) => Boolean(e))
      .forEach((e) => {
        const [t, r] = e.split(" ");
        this._processCommand(t, r);
      }),
      r();
  }
  _processCommand(e, t) {
    const r = parseInt(t);
    switch (e) {
      case bt.FILE_PATH:
        this._resetState(),
          this.playbackStatusSource.next({ status: exports.DolphinPlaybackStatus.FILE_LOADED, data: { path: t } });
        break;
      case bt.LRAS:
        this.state.forceQuit = !0;
        break;
      case bt.CURRENT_FRAME:
        this._handleCurrentFrame(r);
        break;
      case bt.PLAYBACK_START_FRAME:
        this._handlePlaybackStartFrame(r);
        break;
      case bt.PLAYBACK_END_FRAME:
        this._handlePlaybackEndFrame(r);
        break;
      case bt.GAME_END_FRAME:
        this.state.lastGameFrame = r;
        break;
      case bt.NO_GAME:
        this._handleNoGame();
        break;
      default:
        console.error(`Unknown command ${e} with value ${t}`);
    }
  }
  _handleCurrentFrame(e) {
    (this.state.currentFrame = e),
      this.state.currentFrame === this.state.startPlaybackFrame
        ? this.playbackStatusSource.next({ status: exports.DolphinPlaybackStatus.PLAYBACK_START })
        : this.state.currentFrame === this.state.endPlaybackFrame &&
          (this.playbackStatusSource.next({
            status: exports.DolphinPlaybackStatus.PLAYBACK_END,
            data: { gameEnded: this.state.gameEnded, forceQuit: this.state.forceQuit },
          }),
          this._resetState());
  }
  _handlePlaybackStartFrame(e) {
    this.state.startPlaybackFrame = Math.max(e, e + this.buffers.startBuffer);
  }
  _handlePlaybackEndFrame(e) {
    (this.state.endPlaybackFrame = e), (this.state.gameEnded = this.state.endPlaybackFrame >= this.state.lastGameFrame);
    const t = Math.max(this.state.startPlaybackFrame, this.state.endPlaybackFrame - this.buffers.endBuffer);
    this.state.endPlaybackFrame = Math.min(t, this.state.lastGameFrame);
  }
  _handleNoGame() {
    this.playbackStatusSource.next({ status: exports.DolphinPlaybackStatus.QUEUE_EMPTY });
  }
  _resetState() {
    this.state = Object.assign({}, _t);
  }
}
const Et = {
  dolphinPath: "",
  meleeIsoPath: "",
  batch: !1,
  disableSeekBar: !1,
  readEvents: !0,
  startBuffer: 1,
  endBuffer: 1,
};
const It = {
    shuffle: !1,
    mode: "queue",
    replay: "",
    isRealTimeMode: !1,
    outputOverlayFiles: !0,
    startBuffer: 240,
    endBuffer: 180,
  },
  At = (e, t) => {
    const r = Object.assign({}, It, t),
      n = (r.shuffle ? s.shuffle(e) : e).map((e) => gt(e, r.startBuffer, r.endBuffer));
    return {
      mode: r.mode,
      replay: r.replay,
      isRealTimeMode: r.isRealTimeMode,
      outputOverlayFiles: r.outputOverlayFiles,
      queue: n,
    };
  },
  gt = (e, t, r) => {
    const { combo: n, ...s } = e;
    return (
      n && ((s.startFrame = Math.max(o.Frames.FIRST, n.startFrame - t)), n.endFrame && (s.endFrame = n.endFrame + r)), s
    );
  },
  Ct = (e) => n.merge(e(0), e(1), e(2), e(3)),
  Dt = (e) =>
    Object.keys(e.players)
      .map((t) => e.players[t].post)
      .reduce((e, t) =>
        e.stocksRemaining > t.stocksRemaining
          ? e
          : e.stocksRemaining < t.stocksRemaining
          ? t
          : e.percent < t.percent
          ? e
          : e.percent > t.percent
          ? t
          : e,
      ).playerIndex;
function wt(e, t, r = 1) {
  const n = dt(...t);
  return (t) =>
    t.pipe(
      Fe(e),
      H((t) => {
        const r = t.players[e].pre.physicalButtons,
          o = (r & n) === n;
        return { frame: t.frame, buttonPressed: o, buttonCombo: mt(r) };
      }),
      (function (e, t) {
        var r = !1;
        return (
          arguments.length >= 2 && (r = !0),
          function (n) {
            return n.lift(new re(e, t, r));
          }
        );
      })((e, t) => ({ count: t.buttonPressed ? e.count + 1 : 0, frame: t.frame, buttonCombo: t.buttonCombo }), {
        count: 0,
        frame: o.Frames.FIRST,
        buttonCombo: [],
      }),
      q((e) => e.count === r),
      H((t) => ({ playerIndex: e, combo: t.buttonCombo, frame: t.frame, duration: r })),
    );
}
const Tt = (e, t) => {
    const r = e.events
      .filter((e) => e.type === exports.InputEvent.BUTTON_COMBO)
      .filter((e) => e.filter && e.filter.combo && e.filter.combo.length > 0)
      .map((r) => {
        let n = 1;
        r.filter.duration && r.filter.duration > 1 && (n = Math.floor(r.filter.duration));
        let o = t(r.filter.combo, n);
        return (
          r.filter && void 0 !== r.filter.playerIndex && (o = o.pipe(De(r.filter.playerIndex, e.variables))),
          o.pipe(H((e) => ({ id: r.id, type: r.type, payload: e })))
        );
      });
    return n.merge(...r);
  },
  Pt = (e, t) => {
    const r = e.events
      .filter((e) => e.type === exports.StockEvent.PLAYER_SPAWN)
      .map((r) => {
        let n = t;
        const o = r.filter;
        if (o)
          for (const t of Object.keys(o))
            switch (t) {
              case "playerIndex":
                n = n.pipe(De(o.playerIndex, e.variables));
            }
        return n.pipe(H((e) => ({ id: r.id, type: r.type, payload: e })));
      });
    return n.merge(...r);
  },
  Rt = (e, t) => {
    const r = e.events
      .filter((e) => e.type === exports.StockEvent.PLAYER_DIED)
      .map((r) => {
        const n = r.filter;
        let o = t;
        return (
          n && void 0 !== n.playerIndex && (o = o.pipe(De(n.playerIndex, e.variables))),
          o.pipe(H((e) => ({ id: r.id, type: r.type, payload: e })))
        );
      });
    return n.merge(...r);
  },
  Mt = (e, t, r) => {
    const n = t.filter;
    if (n && n.playerIndex) {
      const t = n.playerIndex;
      e = e.pipe(q((e) => we(e.combo.playerIndex, t, r)));
    }
    return e;
  },
  Ft = (e, t, r) => {
    const n = t.filter;
    let o = Object.assign({}, ut);
    if (n && n.comboCriteria) {
      const t = n.comboCriteria;
      if ("string" == typeof t) {
        if ("$" === t.charAt(0) && r[t]) o = Object.assign(o, r[t]);
        else if ("none" === t) return e;
      } else o = Object.assign(o, t);
    }
    return e.pipe(q((e) => pt(o, e.combo, e.settings)));
  };
class Ot {
  constructor(e) {
    (this.playerPermutations = new Array()),
      (this.conversions = new Array()),
      (this.state = new Map()),
      (this.conversionSource = new n.Subject()),
      (this.end$ = this.conversionSource.asObservable()),
      (this.stream$ = e),
      this.stream$.pipe(ye((e) => e.gameStart$)).subscribe((e) => {
        if ((this.resetState(), 2 === e.players.length)) {
          const t = o.getSinglesPlayerPermutationsFromSettings(e);
          this.setPlayerPermutations(t), (this.settings = e);
        }
      }),
      this.stream$
        .pipe(
          ye((e) => e.playerFrame$),
          q((e) => 2 === Object.keys(e.players).length),
          Oe(),
        )
        .subscribe(([e, t]) => {
          this.processFrame(e, t);
        });
  }
  resetState() {
    (this.playerPermutations = new Array()), (this.state = new Map()), (this.conversions = new Array());
  }
  setPlayerPermutations(e) {
    (this.playerPermutations = e),
      this.playerPermutations.forEach((e) => {
        this.state.set(e, { conversion: null, move: null, resetCounter: 0, lastHitAnimation: null });
      });
  }
  processFrame(e, t) {
    this.playerPermutations.forEach((r) => {
      (function (e, t, r, n, s) {
        const i = n.players[t.playerIndex].post,
          a = r.players[t.playerIndex].post,
          c = n.players[t.opponentIndex].post,
          u = r.players[t.opponentIndex].post,
          p = o.isDamaged(c.actionStateId),
          l = o.isGrabbed(c.actionStateId),
          h = o.calcDamageTaken(c, u),
          d = i.actionStateId !== e.lastHitAnimation,
          f = i.actionStateCounter,
          m = a.actionStateCounter,
          b = f < m;
        (d || b) && (e.lastHitAnimation = null);
        (p || l) &&
          (e.conversion ||
            ((e.conversion = {
              playerIndex: t.playerIndex,
              opponentIndex: t.opponentIndex,
              startFrame: i.frame,
              endFrame: null,
              startPercent: u.percent || 0,
              currentPercent: c.percent || 0,
              endPercent: null,
              moves: [],
              didKill: !1,
              openingType: "unknown",
            }),
            s.push(e.conversion)),
          h &&
            (e.lastHitAnimation ||
              ((e.move = { frame: i.frame, moveId: i.lastAttackLanded, hitCount: 0, damage: 0 }),
              e.conversion.moves.push(e.move)),
            e.move && ((e.move.hitCount += 1), (e.move.damage += h)),
            (e.lastHitAnimation = a.actionStateId)));
        if (!e.conversion) return;
        const y = o.isInControl(c.actionStateId),
          S = o.didLoseStock(c, u);
        S || (e.conversion.currentPercent = c.percent || 0);
        (p || l) && (e.resetCounter = 0);
        const v = 0 === e.resetCounter && y,
          _ = e.resetCounter > 0;
        (v || _) && (e.resetCounter += 1);
        let x = !1;
        S && ((e.conversion.didKill = !0), (x = !0));
        e.resetCounter > o.Timers.PUNISH_RESET_FRAMES && (x = !0);
        x &&
          ((e.conversion.endFrame = i.frame),
          (e.conversion.endPercent = u.percent || 0),
          (e.conversion = null),
          (e.move = null));
        return x;
      })(this.state.get(r), r, e, t, this.conversions) &&
        this.conversionSource.next({ combo: s.last(this.conversions), settings: this.settings });
    });
  }
}
var Nt;
!(function (e) {
  (e.Start = "start"), (e.Extend = "extend"), (e.End = "end");
})(Nt || (Nt = {}));
class Lt {
  constructor(e) {
    (this.playerPermutations = new Array()),
      (this.state = new Map()),
      (this.combos = new Array()),
      (this.comboStartSource = new n.Subject()),
      (this.comboExtendSource = new n.Subject()),
      (this.comboEndSource = new n.Subject()),
      (this.start$ = this.comboStartSource.asObservable()),
      (this.extend$ = this.comboExtendSource.asObservable()),
      (this.end$ = this.comboEndSource.asObservable()),
      (this.stream$ = e);
    const t = new Ot(e);
    (this.conversion$ = t.end$),
      this.stream$.pipe(ye((e) => e.gameStart$)).subscribe((e) => {
        if ((this.resetState(), 2 === e.players.length)) {
          const t = o.getSinglesPlayerPermutationsFromSettings(e);
          this.setPlayerPermutations(t), (this.settings = e);
        }
      }),
      this.stream$
        .pipe(
          ye((e) => e.playerFrame$),
          q((e) => 2 === Object.keys(e.players).length),
          Oe(),
        )
        .subscribe(([e, t]) => {
          this.processFrame(e, t);
        });
  }
  resetState() {
    (this.playerPermutations = new Array()), (this.state = new Map()), (this.combos = new Array());
  }
  setPlayerPermutations(e) {
    (this.playerPermutations = e),
      this.playerPermutations.forEach((e) => {
        this.state.set(e, { combo: null, move: null, resetCounter: 0, lastHitAnimation: null, event: null });
      });
  }
  processFrame(e, t) {
    this.playerPermutations.forEach((r) => {
      const n = this.state.get(r);
      switch (
        ((function (e, t, r, n, s) {
          const i = n.players[t.playerIndex].post,
            a = r.players[t.playerIndex].post,
            c = n.players[t.opponentIndex].post,
            u = r.players[t.opponentIndex].post,
            p = o.isDamaged(c.actionStateId),
            l = o.isGrabbed(c.actionStateId),
            h = o.calcDamageTaken(c, u),
            d = i.actionStateId !== e.lastHitAnimation,
            f = i.actionStateCounter,
            m = a.actionStateCounter,
            b = f < m;
          (d || b) && (e.lastHitAnimation = null);
          if (p || l) {
            let r = !1;
            e.combo ||
              ((e.combo = {
                playerIndex: t.playerIndex,
                opponentIndex: t.opponentIndex,
                startFrame: i.frame,
                endFrame: null,
                startPercent: u.percent || 0,
                currentPercent: c.percent || 0,
                endPercent: null,
                moves: [],
                didKill: !1,
              }),
              s.push(e.combo),
              (r = !0)),
              h &&
                (e.lastHitAnimation ||
                  ((e.move = { frame: i.frame, moveId: i.lastAttackLanded, hitCount: 0, damage: 0 }),
                  e.combo.moves.push(e.move),
                  r || (e.event = Nt.Extend)),
                e.move && ((e.move.hitCount += 1), (e.move.damage += h)),
                (e.lastHitAnimation = a.actionStateId)),
              r && (e.event = Nt.Start);
          }
          if (!e.combo) return;
          const y = o.isTeching(c.actionStateId),
            S = o.isDown(c.actionStateId),
            v = o.didLoseStock(c, u),
            _ = o.isDead(c.actionStateId);
          v || (e.combo.currentPercent = c.percent || 0);
          p || l || y || S || _ ? (e.resetCounter = 0) : (e.resetCounter += 1);
          let x = !1;
          v && ((e.combo.didKill = !0), (x = !0));
          e.resetCounter > o.Timers.COMBO_STRING_RESET_FRAMES && (x = !0);
          x &&
            ((e.combo.endFrame = i.frame),
            (e.combo.endPercent = u.percent || 0),
            (e.event = Nt.End),
            (e.combo = null),
            (e.move = null));
        })(n, r, e, t, this.combos),
        n.event)
      ) {
        case Nt.Start:
          this.comboStartSource.next({ combo: n.combo, settings: this.settings });
          break;
        case Nt.Extend:
          this.comboExtendSource.next({ combo: n.combo, settings: this.settings });
          break;
        case Nt.End:
          this.comboEndSource.next({ combo: s.last(this.combos), settings: this.settings });
      }
      null !== n.event && (n.event = null);
    });
  }
}
class Bt {
  constructor(e) {
    (this.stream$ = e),
      (this.start$ = this.stream$.pipe(ye((e) => e.gameStart$))),
      (this.end$ = this.stream$.pipe(
        ye((e) =>
          e.gameEnd$.pipe(
            Ie(e.playerFrame$),
            H(([e, t]) => ({ ...e, winnerPlayerIndex: Dt(t), lastFrame: t })),
          ),
        ),
      )),
      (this.rawFrames$ = Ct((e) =>
        this.stream$.pipe(
          ye((e) => e.playerFrame$),
          Fe(e),
        ),
      ));
  }
}
class kt {
  constructor(e) {
    this.stream$ = e;
  }
  buttonCombo(e, t) {
    return Ct((r) => this.playerIndexButtonCombo(r, e, t));
  }
  playerIndexButtonCombo(e, t, r = 1) {
    return this.stream$.pipe(
      ye((e) => e.playerFrame$),
      wt(e, t, r),
    );
  }
}
class Gt {
  constructor(e) {
    (this.stream$ = e),
      (this.playerSpawn$ = Ct((e) => this.playerIndexSpawn(e))),
      (this.playerDied$ = Ct((e) => this.playerIndexDied(e))),
      (this.percentChange$ = Ct((e) => this.playerIndexPercentChange(e))),
      (this.countChange$ = Ct((e) => this.playerIndexStockCountChange(e)));
  }
  playerIndexSpawn(e) {
    return this.stream$.pipe(
      ye((t) =>
        t.playerFrame$.pipe(
          Le(e),
          H((t) => t.players[e].post),
          Be(t.gameStart$, e),
        ),
      ),
    );
  }
  playerIndexDied(e) {
    return this.stream$.pipe(
      ye((e) => e.playerFrame$),
      Fe(e),
      H((t) => t.players[e].post),
      Oe(),
      q(([e, t]) => o.didLoseStock(t, e)),
      ke(this.playerIndexSpawn(e)),
    );
  }
  playerIndexPercentChange(e) {
    return this.stream$.pipe(
      ye((e) => e.playerFrame$),
      Fe(e),
      H((t) => t.players[e].post.percent),
      Y(),
      H((t) => ({ playerIndex: e, percent: t })),
    );
  }
  playerIndexStockCountChange(e) {
    return this.stream$.pipe(
      ye((e) => e.playerFrame$),
      Fe(e),
      H((t) => t.players[e].post.stocksRemaining),
      Y(),
      H((t) => ({ playerIndex: e, stocksRemaining: t })),
    );
  }
}
class jt extends o.SlpFileWriter {
  constructor(e, t) {
    super({ ...e, outputFiles: e && !0 === e.outputFiles }, t),
      (this.parser = new o.SlpParser({ strict: !0 })),
      (this.messageSizeSource = new n.Subject()),
      (this.messageSize$ = this.messageSizeSource.asObservable()),
      (this.gameStart$ = n.fromEvent(this.parser, o.SlpParserEvent.SETTINGS).pipe(be())),
      (this.playerFrame$ = n.fromEvent(this.parser, o.SlpParserEvent.FINALIZED_FRAME).pipe(be())),
      (this.gameEnd$ = n.fromEvent(this.parser, o.SlpParserEvent.END).pipe(be())),
      this.on(o.SlpStreamEvent.COMMAND, (e) => {
        const { command: t, payload: r } = e;
        switch (t) {
          case o.Command.MESSAGE_SIZES:
            this.parser.reset(), this.messageSizeSource.next(r);
        }
        try {
          this.parser.handleCommand(t, r);
        } catch (e) {
          console.error(`Error processing command ${t}: ${e}`);
        }
      });
  }
  restart() {
    this.parser.reset(), super.restart();
  }
}
const Ut = (e, t) => {
  const r = new Promise((t, r) => {
    const n = setTimeout(() => {
      clearTimeout(n), r(new Error(`Timed out after ${e}ms.`));
    }, e);
  });
  return Promise.race([t, r]);
};
Object.defineProperty(exports, "Character", {
  enumerable: !0,
  get: function () {
    return o.Character;
  },
}),
  Object.defineProperty(exports, "ConnectionEvent", {
    enumerable: !0,
    get: function () {
      return o.ConnectionEvent;
    },
  }),
  Object.defineProperty(exports, "ConnectionStatus", {
    enumerable: !0,
    get: function () {
      return o.ConnectionStatus;
    },
  }),
  Object.defineProperty(exports, "ConsoleConnection", {
    enumerable: !0,
    get: function () {
      return o.ConsoleConnection;
    },
  }),
  Object.defineProperty(exports, "Frames", {
    enumerable: !0,
    get: function () {
      return o.Frames;
    },
  }),
  Object.defineProperty(exports, "SlippiGame", {
    enumerable: !0,
    get: function () {
      return o.SlippiGame;
    },
  }),
  Object.defineProperty(exports, "SlpStreamEvent", {
    enumerable: !0,
    get: function () {
      return o.SlpStreamEvent;
    },
  }),
  Object.defineProperty(exports, "SlpStreamMode", {
    enumerable: !0,
    get: function () {
      return o.SlpStreamMode;
    },
  }),
  Object.defineProperty(exports, "Stage", {
    enumerable: !0,
    get: function () {
      return o.Stage;
    },
  }),
  (exports.ALL_CRITERIA = ct),
  (exports.ComboDidKill = at),
  (exports.ComboFilter = class {
    constructor(e) {
      (this.settings = Object.assign({}, ut, e)),
        (this.originalSettings = Object.assign({}, this.settings)),
        (this.criteria = [...ct]);
    }
    updateSettings(e) {
      return (this.settings = Object.assign({}, this.settings, e)), this.getSettings();
    }
    getSettings() {
      return Object.assign({}, this.settings);
    }
    resetSettings() {
      return this.updateSettings(this.originalSettings);
    }
    isCombo(e, t, r) {
      return pt(this.settings, e, t, r, this.criteria);
    }
  }),
  (exports.DolphinLauncher = class {
    constructor(e) {
      (this.dolphin = null),
        (this.dolphinRunningSource = new n.BehaviorSubject(!1)),
        (this.dolphinRunning$ = this.dolphinRunningSource.asObservable()),
        (this.options = Object.assign({}, Et, e)),
        (this.output = new xt(this.options));
    }
    updateSettings(e) {
      (this.options = Object.assign(this.options, e)), this.output.setBuffer(this.options);
    }
    loadJSON(e) {
      this.dolphin && (this.dolphin.kill(), (this.dolphin = null)),
        (this.dolphin = this._startDolphin(e)),
        this.dolphin.on("exit", (e) => {
          0 !== e && console.warn("Dolphin terminated with exit code: " + e), this.dolphinRunningSource.next(!1);
        }),
        this.dolphin.stdout.pipe(this.output, { end: !1 }),
        this.dolphinRunningSource.next(!0);
    }
    _startDolphin(e) {
      if (!this.options.dolphinPath) throw new Error("Dolphin path is not set!");
      const t = ["-i", e];
      return (
        this.options.meleeIsoPath && t.push("-e", this.options.meleeIsoPath),
        this.options.readEvents && t.push("--cout"),
        this.options.batch && t.push("--batch"),
        this.options.disableSeekBar && t.push("--hide-seekbar"),
        i.spawn(this.options.dolphinPath, t)
      );
    }
  }),
  (exports.DolphinOutput = xt),
  (exports.EventManager = class {
    constructor(e) {
      (this.config$ = new n.ReplaySubject()), (this.realtime = e), (this.events$ = this.setupSubscriptions());
    }
    updateConfig(e) {
      this.config$.next(e);
    }
    setupSubscriptions() {
      return this.config$.pipe(
        ye((e) =>
          n.merge(
            ((e, t) => n.merge(Te(t, e.start$), Pe(t, e.end$)))(this.realtime.game, e),
            ((e, t) => Tt(t, (t, r) => e.buttonCombo(t, r)))(this.realtime.input, e),
            ((e, t) => n.merge(Pt(t, e.playerSpawn$), Rt(t, e.playerDied$)))(this.realtime.stock, e),
            ((e, t) => {
              const r = [
                ...t.events
                  .filter((e) => e.type === exports.ComboEvent.START)
                  .map((r) => Mt(e.start$, r, t.variables).pipe(H((e) => ({ id: r.id, type: r.type, payload: e })))),
                ...t.events
                  .filter((e) => e.type === exports.ComboEvent.EXTEND)
                  .map((r) => Mt(e.extend$, r, t.variables).pipe(H((e) => ({ id: r.id, type: r.type, payload: e })))),
                ...t.events
                  .filter((e) => e.type === exports.ComboEvent.END)
                  .map((r) => {
                    const n = Mt(e.end$, r, t.variables);
                    return Ft(n, r, t.variables).pipe(H((e) => ({ id: r.id, type: r.type, payload: e })));
                  }),
                ...t.events
                  .filter((e) => e.type === exports.ComboEvent.CONVERSION)
                  .map((r) => {
                    const n = Mt(e.conversion$, r, t.variables);
                    return Ft(n, r, t.variables).pipe(H((e) => ({ id: r.id, type: r.type, payload: e })));
                  }),
              ];
              return n.merge(...r);
            })(this.realtime.combo, e),
          ),
        ),
      );
    }
  }),
  (exports.ExcludesCPUs = st),
  (exports.ExcludesChainGrabs = et),
  (exports.ExcludesLargeSingleHit = ot),
  (exports.ExcludesWobbles = tt),
  (exports.IsOneVsOne = it),
  (exports.MatchesCharacter = Qe),
  (exports.MatchesPlayerName = ze),
  (exports.MatchesPortNumber = Xe),
  (exports.RxSlpStream = jt),
  (exports.SatisfiesMinComboLength = rt),
  (exports.SatisfiesMinComboPercent = nt),
  (exports.SlpFolderStream = class extends jt {
    constructor(e, t) {
      super({ ...e, mode: o.SlpStreamMode.MANUAL }, t),
        (this.startRequested$ = new n.Subject()),
        (this.stopRequested$ = new n.Subject()),
        (this.newFile$ = new n.BehaviorSubject(null)),
        (this.readStream = null),
        this._setupSubjects();
    }
    _setupSubjects() {
      this.newFile$.subscribe((e) => {
        e &&
          (console.log("found a new file: " + e),
          this.endReadStream(),
          super.restart(),
          (this.readStream = h.createReadStream(e)),
          this.readStream.pipe(this, { end: !1 }));
      }),
        this.startRequested$
          .pipe(
            ye(([e, t]) => {
              this.endReadStream();
              const r = t ? "**" : "",
                o = p.join(e, r, "*.slp"),
                s = l.watch(o, {
                  ignored: /(^|[\/\\])\../,
                  persistent: !0,
                  ignoreInitial: !0,
                  ignorePermissionErrors: !0,
                });
              return n.fromEvent(s, "add").pipe(
                be(),
                H(([e]) => p.resolve(e)),
                _e(this.stopRequested$),
              );
            }),
          )
          .subscribe(this.newFile$);
    }
    endReadStream() {
      this.readStream && (this.readStream.unpipe(this), this.readStream.done(), (this.readStream = null));
    }
    start(e, t) {
      console.log(`Start monitoring${t ? " with subfolders" : ""}: ${e}`), this.startRequested$.next([e, Boolean(t)]);
    }
    stop() {
      this.endReadStream(), this.stopRequested$.next();
    }
    latestFile() {
      return this.newFile$.value;
    }
  }),
  (exports.SlpLiveStream = class extends jt {
    constructor(e) {
      super(),
        (this.connection = "dolphin" === e ? new o.DolphinConnection() : new o.ConsoleConnection()),
        this.connection.on(o.ConnectionEvent.HANDSHAKE, (e) => {
          this.updateSettings({ consoleNickname: e.consoleNickname });
        }),
        this.connection.on(o.ConnectionEvent.DATA, (e) => {
          this.write(e);
        });
    }
    async start(e, t) {
      const r = new Promise((r, n) => {
        const s = (i) => {
          if (i === o.ConnectionStatus.CONNECTED || i === o.ConnectionStatus.DISCONNECTED)
            switch ((this.connection.removeListener(o.ConnectionEvent.STATUS_CHANGE, s), i)) {
              case o.ConnectionStatus.CONNECTED:
                r();
                break;
              case o.ConnectionStatus.DISCONNECTED:
                n(new Error(`Failed to connect to: ${e}:${t}`));
            }
        };
        this.connection.on(o.ConnectionEvent.STATUS_CHANGE, s);
        try {
          this.connection.connect(e, t);
        } catch (e) {
          n(e);
        }
      });
      return Ut(5e3, r);
    }
  }),
  (exports.SlpRealTime = class {
    constructor() {
      (this.stream$ = new n.ReplaySubject()),
        (this.game = new Bt(this.stream$)),
        (this.stock = new Gt(this.stream$)),
        (this.input = new kt(this.stream$)),
        (this.combo = new Lt(this.stream$));
    }
    setStream(e) {
      this.stream$.next(e);
    }
  }),
  (exports.UnknownMove = He),
  (exports.bitmaskToButtons = mt),
  (exports.checkCombo = pt),
  (exports.defaultComboFilterSettings = ut),
  (exports.extractPlayerNames = Ve),
  (exports.filterJustSpawned = Le),
  (exports.filterOnlyFirstFrame = Ne),
  (exports.findWinner = Dt),
  (exports.forAllPlayerIndices = Ct),
  (exports.generateDolphinQueue = At),
  (exports.generateDolphinQueuePayload = (e, t, r = !0) => {
    const n = At(e, t),
      o = r ? 2 : void 0;
    return JSON.stringify(n, void 0, o);
  }),
  (exports.generateInputBitmask = dt),
  (exports.getAllCharacters = function () {
    return Array.from(Ge.values());
  }),
  (exports.getCharacterColorName = function (e, t) {
    return je(e).colors[t];
  }),
  (exports.getCharacterInfo = je),
  (exports.getCharacterName = Ue),
  (exports.getCharacterShortName = function (e) {
    return je(e).shortName || Ue(e);
  }),
  (exports.getMoveInfo = Ye),
  (exports.getMoveName = function (e) {
    return Ye(e).name;
  }),
  (exports.getMoveShortName = function (e) {
    return Ye(e).shortName;
  }),
  (exports.getStageInfo = Je),
  (exports.getStageName = qe),
  (exports.getStageShortName = function (e) {
    return Je(e).shortName || qe(e);
  }),
  (exports.mapFrameToSpawnStockType = Be),
  (exports.mapFramesToButtonInputs = wt),
  (exports.mapFramesToDeathStockType = ke),
  (exports.namesMatch = Ze),
  (exports.pausable = function (e, t) {
    return (r) => {
      return r.pipe(
        _e(e),
        ((n = () => t),
        function (e) {
          return e.lift(new de(n));
        }),
      );
      var n;
    };
  }),
  (exports.pipeFileContents = async (e, t, r) =>
    new Promise((n) => {
      const o = u.createReadStream(e);
      o.on("open", () => {
        o.pipe(t, r);
      }),
        o.on("close", () => {
          n();
        });
    })),
  (exports.playerFilter = De),
  (exports.playerFilterMatches = we),
  (exports.playerFrameFilter = Fe),
  (exports.throttleInputButtons = function (e) {
    return (t) => t.pipe(Y((t, r) => r.frame < t.frame + e));
  }),
  (exports.withPreviousFrame = Oe);
